/*! Childify Me plugin by Rocco Aliberti, GPL2+ licensed */
jQuery(function(i){var a={MAIN_PANEL:"#customize-info",TEMPLATE:"script#childify-tpl",CHILDIFY_CONTAINER:"#childify-container",ADD_NEW_BUTTON:"#cm-add-new",FORM_CONTAINER:"#cm-form-container",INPUT_CNAME:"#cm-cname",CREATE_BUTTON:"#cm-create",CANCEL_BUTTON:"#cm-cancel",FTP_FORM:"#ftp-form",FTP_UPGRADE_BUTTON:"input#upgrade",PREVIEW_BUTTON:"#cm-preview",SUCCESS_MESS_BOX:"#cm-success",INFO_BOX:"#cm-info",THEME_NAME:"#cm-ctheme",WP_CONTAINER:".wp-full-overlay-sidebar-content"},e=i(a.MAIN_PANEL).parent(),t=_.template(i(a.TEMPLATE).html()),n="action="+CMAdmin.Action+"&"+("CMnonce="+CMAdmin.CMnonce)+"&"+("parent="+CMAdmin.Parent),r=CMAdmin.AjaxUrl;function T(){var e=n+"&"+i(a.CHILDIFY_CONTAINER+" form").serialize();i.post(r,e,function(e){var t;void 0!==(t=e).success?(t.success?(i(a.THEME_NAME).append(i(a.INPUT_CNAME).val()),i(a.PREVIEW_BUTTON).attr("href",i(a.PREVIEW_BUTTON).attr("href")+t.data.stylesheet)):E(t.data.message),N(),i(a.SUCCESS_MESS_BOX).css("display","block")):-1<t.indexOf("<form")?(d(),i(a.FORM_CONTAINER).append('<div id="'+a.FTP_FORM.substr(1)+'">'+t+"</div>"),C(a.FTP_FORM),i(a.FTP_FORM+' input[name="hostname"]').focus()):(N(),E(t),i(a.SUCCESS_MESS_BOX).css("display","block"))})}function o(e,t){return!e.attr("disabled")&&("click"===t.type||13===t.which)}function c(e){e?(i(a.CREATE_BUTTON).removeAttr("disabled"),i(a.CANCEL_BUTTON).removeAttr("disabled")):(i(a.CREATE_BUTTON).attr("disabled","disabled"),i(a.CANCEL_BUTTON).attr("disabled","disabled"))}function s(e,t){return t&&e.val(i.trim(e.val())),""!=e.val().replace(/^\s+/,"")}function E(e){i(a.SUCCESS_MESS_BOX+" > p").text(e||"Error"),i(a.SUCCESS_MESS_BOX).removeClass("updated").addClass("error"),i(a.SUCCESS_MESS_BOX+" "+a.PREVIEW_BUTTON).detach()}function N(){i([a.FORM_CONTAINER,a.ADD_NEW_BUTTON,a.INFO_BOX].join(",")).detach()}function d(){0<i(a.FTP_FORM).length&&i(a.FTP_FORM).detach()}function C(e){var t=i(a.WP_CONTAINER),n=parseInt(i(e).offset().top)-parseInt(t.offset().top)+parseInt(t.scrollTop());t.animate({scrollTop:n},700)}e.append(t()),e.on("keypress click",a.ADD_NEW_BUTTON,function(e){if(o(i(this),e)){i(this).toggleClass("open"),i(a.FORM_CONTAINER).slideToggle("fast");var t=i(a.INPUT_CNAME);t.attr("readonly")||C(t.focus())}}).on("keypress click",a.CANCEL_BUTTON,function(e){o(i(this),e)&&(i(a.INPUT_CNAME).removeAttr("readonly").val(""),i(a.CREATE_BUTTON).removeAttr("disabled"),d(),c(s(i(a.INPUT_CNAME))))}).on("keypress click",a.CREATE_BUTTON,function(e){o(i(this),e)&&s(i(a.INPUT_CNAME),!0)&&(i(this).attr("disabled","disabled"),i(a.INPUT_CNAME).attr("readonly","readonly"),T())}).on("keyup blur",a.INPUT_CNAME,function(e){if(!i(this).attr("readonly")){if(e.keyCode){if(34<e.keyCode&&e.keyCode<41||16==e.keyCode)return;if(13==e.keyCode)return void i(a.CREATE_BUTTON).trigger("click")}c(s(i(this)))}}).on("keydown click",a.CHILDIFY_CONTAINER+" "+a.FTP_UPGRADE_BUTTON,function(e){e.preventDefault(),o(i(this),e)&&(i(this).attr("disabled","disabled"),T())}),i(document).ready(function(e){c(!1),e(a.CHILDIFY_CONTAINER).css("display","block")})});